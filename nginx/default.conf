charset utf-8;

# 메인 Nginx - Reverse Proxy
# Docker Network: app-network
# 하위 서비스: nginx-moon, nginx-lee, nginx-park, fastapi-app

server {
    listen 80;
    server_name _;

    # 헬스체크
    location = /health {
        return 200 'OK';
        add_header Content-Type text/plain;
    }

    # 기본 페이지 (메인)
    location = / {
        return 200 '
        <!DOCTYPE html>
        <html>
        <head><title>팀 메인</title></head>
        <body style="font-family:Arial;text-align:center;padding:50px;">
            <h1>팀 서비스</h1>
            <ul style="list-style:none;">
                <li><a href="/moon/">문이정</a></li>
                <li><a href="/lee/">이민석</a></li>
                <li><a href="/park/">박선우</a></li>
                <li><a href="/api/">FastAPI</a></li>
            </ul>
        </body>
        </html>';
        add_header Content-Type text/html;
    }

    # 문이정 페이지
    location /moon/ {
        proxy_pass http://nginx-moon:80/;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # 이민석 페이지
    location /lee/ {
        proxy_pass http://nginx-lee:80/;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # 박선우 페이지
    location /park/ {
        proxy_pass http://nginx-park:80/;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # FastAPI API
    location /api/ {
        proxy_pass http://fastapi-app:8000/;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
